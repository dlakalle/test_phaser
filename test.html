<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Juego Phaser</title>
		<link rel="icon" href="assets/sprites/mario.png">
		<script src="bower_components/phaser/build/phaser.min.js"></script>
	</head>
	<body>
		<div id="phaser-canvas"></div>
	</body>
	<script type="text/javascript">
		var game = new Phaser.Game(960, 320, Phaser.AUTO, "phaser-canvas");

	    var Character = function (game, x, y, spriteKey, scale) {

	        Phaser.Sprite.call(this, game, x, y, spriteKey);

	        // this.texture.baseTexture.scaleMode = PIXI.scaleModes.NEAREST;

	        this.anchor.set(0.5);

        	this.scale.set(scale);

        	this.characterName = spriteKey;
	    };

	    Character.prototype = Object.create(Phaser.Sprite.prototype);
	    Character.prototype.constructor = Character;

	    Character.prototype.update = function(){
	    	// console.log("calling update on character:", this.characterName);
	    };

	    var PhaserState = function () {
	        this.player = null;
	        this.cursors = null;
	    };

	    PhaserState.prototype = {

	        init: function () {

	            this.game.renderer.renderSession.roundPixels = true;
	            this.physics.startSystem(Phaser.Physics.ARCADE);
	        },

	        preload: function () {
	        	this.load.spritesheet("dude", "assets/sprites/dude.png", 32, 48);
      			this.load.image("tiles", "assets/maps/super_mario.png");
      			this.load.tilemap("scene", "assets/maps/tiled_mario.json", null, Phaser.Tilemap.TILED_JSON);

	            this.load.bitmapFont("shmupfont", "assets/fonts/shmupfont.png", "assets/fonts/shmupfont.xml");
	        },

	        create: function () {

	        	this.map = this.add.tilemap("scene");
				this.map.addTilesetImage("SuperMarioBros-World1-1", "tiles");

				this.map.setCollisionBetween(15, 15);

				this.layer = this.map.createLayer("World1");
				this.layer.fixedToCamera = false;

				// this.layer.debug = true;
				// this.layer.resizeWorld();

				this.player = new Character(this.game, 5, 5, "dude", 0.6);


				this.physics.arcade.gravity.y = 250;
				this.physics.enable(this.player);

				this.player.body.collideWorldBounds = true;

				this.player.inputEnabled = true;
				this.player.events.onInputDown.add(this.listener, this);

				this.player.animations.add("left", [0,1,2,3], 10, true);
				this.player.animations.add("right", [5,6,7,8], 10, true);
				this.player.frame = 4;

				//maybe this.game
				this.cursors = this.input.keyboard.createCursorKeys();

	            // this.dude = new Character(this.game, 130, 200, "dude", 1.2);

	            this.add.existing(this.player);
	        },

	        update: function () {
	        	this.physics.arcade.collide(this.player, this.layer);
				this.player.body.velocity.x = 0;

				if(this.cursors.up.isDown){
					if(this.player.body.onFloor()){
					  this.player.body.velocity.y = -200;
					}
				}
				if(this.cursors.left.isDown){
					this.player.body.velocity.x = -150;
					this.player.animations.play("left");
				}
				else if(this.cursors.right.isDown){
					this.player.body.velocity.x = 150;
					this.player.animations.play("right");
				}
				else {
					this.player.animations.stop();
					this.player.frame = 4;
				}
	        },
	        render: function(){
	        	// this.game.debug.body(this.player, "#888888", true);
	        },

	        listener: function(){
	        	console.log("I'm not Mario");
	        }

	    };

	    game.state.add("Game", PhaserState, true);
	</script>
</html>